@using AplikasiSurat.Services
@inject AuthenticationStateProvider AuthStateProvider
@inject NavigationManager Navigation

<div class="top-row navbar navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="">
            <i class="bi bi-envelope-heart-fill"></i>
            <span>Aplikasi Surat</span>
        </a>
        <button title="Navigation menu" class="navbar-toggler" @onclick="ToggleNavMenu">
            <span class="navbar-toggler-icon"></span>
        </button>
    </div>
</div>

<div class="@NavMenuCssClass nav-scrollable">
    <nav class="flex-column h-100">
        <AuthorizeView Context="authContext">
            <Authorized>
                <div class="nav-item">
                    <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                        <i class="bi bi-house-heart-fill"></i>
                        <span>Dashboard</span>
                    </NavLink>
                </div>
                <div class="nav-item">
                    <NavLink class="nav-link" href="surat-masuk">
                        <i class="bi bi-inbox-fill"></i>
                        <span>Surat Masuk</span>
                    </NavLink>
                </div>
                <div class="nav-item">
                    <NavLink class="nav-link" href="surat-keluar">
                        <i class="bi bi-send-fill"></i>
                        <span>Surat Keluar</span>
                    </NavLink>
                </div>

                <div class="user-profile-section">
                    <div class="user-profile">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-person-circle me-3"></i>
                            <div class="flex-grow-1">
                                <small class="d-block" style="color: rgba(255,255,255,0.6); font-size: 0.7rem;">Logged in as</small>
                                <span class="fw-bold d-block" style="color: #fff; font-size: 1.1rem;">@authContext.User.Identity?.Name</span>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-outline-light w-100" @onclick="Logout">
                        <i class="bi bi-box-arrow-right me-2"></i>
                        <span>Logout</span>
                    </button>
                </div>
            </Authorized>
            <NotAuthorized>
                <div class="nav-item">
                    <NavLink class="nav-link" href="login">
                        <i class="bi bi-box-arrow-in-right"></i>
                        <span>Login</span>
                    </NavLink>
                </div>
            </NotAuthorized>
        </AuthorizeView>
    </nav>
</div>

@code {
    private bool collapseNavMenu = true;

    private string? NavMenuCssClass => collapseNavMenu ? "collapse" : null;

    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }

    private void Logout()
    {
        ((CustomAuthenticationStateProvider)AuthStateProvider).Logout();
        Navigation.NavigateTo("/login");
    }
}
